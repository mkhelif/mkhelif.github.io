<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title> - ROME &#8211; Intégration avec une Servlet (7/8)</title>
  <link rel="shortcut icon" href="/assets/images/favicon.ico">
  <link rel="stylesheet" href="/assets/css/style.css">
  <link rel="alternate" type="application/rss+xml" title="My Blog" href="/rss.xml">
  <link rel="stylesheet" href="/assets/css/highlight.css">
</head>
<body>

  <nav class="main-nav">
    
        <a href='/blog'> <span class="arrow">←</span> Home </a>
    

    
        
    
    <a class="cta" href="/blogfeed.xml">Subscribe</a>
</nav>

  

  <section id="wrapper" class="">
    <article class="post">
    <header>
        <h1>ROME &#8211; Intégration avec une Servlet (7/8)</h1>
        <h2 class="headline">July 22, 2007</h2>
    </header>
    <section id="post-body">
        <p>Dans cet exemple nous créons une servlet qui renvoie un flux en réponse. Le type de flux voulu peut être passé en paramètre d’<acronym title="Uniform Resource Locator">URL</acronym> de la requête. Dans cet exemple les entrées du flux sont écrites en dur, mais il serait tout aussi simple de les générer dynamiquement (depuis une base de données par exemple).</p>

<!--more-->

<p>Le coeur de la servlet FeedServlet est ce bout de code :</p>

<pre lang="java">public class FeedServlet extends HttpServlet {
    ...
    public void doGet (HttpServletRequest req, HttpServletResponse res) throws IOException {
            ...
            SyndFeed feed = getFeed (req);

            String feedType = req.getParameter (FEED_TYPE);
            feedType = (feedType != null) ? feedType : _defaultFeedType;
            feed.setFeedType (feedType);

            res.setContentType (MIME_TYPE);
            SyndFeedOutput output = new SyndFeedOutput ();
            output.output (feed, res.getWriter ());
            ...
    } // doGet ()

    protected SyndFeed getFeed (HttpServletRequest req) throws IOException,FeedException {
        SyndFeed feed = new SyndFeedImpl ();
        ... // Ajout des entrées et des informations sur le flux.
        return feed;
    } // getFeed ()
} // FeedServlet</pre>

<p>La servlet renvoie le flux lors d’une requête HTTP GET avec l’appel à la méthode doGet ().</p>

<p>Pour commencer on récupère l’objet SyndFeed en appelant la méthode getFeed (), on passe l’objet de la requête qui pourrait contenir des informations contextuelles pour créer le flux. La création d’un flux grâce à la classe SyndFeed est expliquée en détail dans le tutorial Écriture d’un flux.</p>

<p>Ensuite on détermine le type de flux souhaité en regardant le paramètre de la requête, si celui-ci n’est pas précisé on choisi un type par défaut (spécifié par un paramètre d’initialisation de la servlet).</p>

<p>Enfin, la réponse est renvoyée avec le bon Content-Type (l’objet constant MIME_TYPE a pour valeur ‘application/xml; charset=UTF-8′) et le flux est écrit en utilisant la classea SyndFeedOutput.</p>

<p>Voici le code complet de la servlet :</p>

<pre lang="java">package com.mkhelif.rome.exemples;

import com.sun.syndication.feed.synd.*;
import com.sun.syndication.io.FeedException;
import com.sun.syndication.io.SyndFeedOutput;

import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;
import java.text.DateFormat;
import java.text.ParseException;
import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.List;

/**
 * Exemple d'une Servlet qui renvoie un flux crée avec ROME.
 *
 * Le type de flux est choisi en fonction du paramètre 'type' de la requête, si le paramètre est manquant
 * on prend la valeur du paramètre d'initialisation de la servlet 'default.feed.type', si se paramètre est manquant, on choisi par
 * défaut 'atom_0.3'.
 *
 * @author Marwan KHELIF
 */
public class FeedServlet extends HttpServlet {
    private static final String DEFAULT_FEED_TYPE = "default.feed.type";
    private static final String FEED_TYPE = "type";
    private static final String MIME_TYPE = "application/xml; charset=UTF-8";
    private static final String COULD_NOT_GENERATE_FEED_ERROR = "Impossible de générer le flux";

    private static final DateFormat DATE_PARSER = new SimpleDateFormat("yyyy-MM-dd");

    private String _defaultFeedType;

    public void init () {
        _defaultFeedType = getServletConfig ().getInitParameter (DEFAULT_FEED_TYPE);
        _defaultFeedType = (_defaultFeedType != null) ? _defaultFeedType : "atom_0.3";
    } // init ()

    public void doGet (HttpServletRequest req, HttpServletResponse res) throws IOException {
        try {
            SyndFeed feed = getFeed (req);

            String feedType = req.getParameter (FEED_TYPE);
            feedType = (feedType != null) ? feedType : _defaultFeedType;
            feed.setFeedType (feedType);

            res.setContentType (MIME_TYPE);
            SyndFeedOutput output = new SyndFeedOutput ();
            output.output (feed, res.getWriter ());
        } catch (FeedException ex) {
            String msg = COULD_NOT_GENERATE_FEED_ERROR;
            log (msg, ex);
            res.sendError (HttpServletResponse.SC_INTERNAL_SERVER_ERROR, msg);
        }
    } // doGet ()

    protected SyndFeed getFeed (HttpServletRequest req) throws IOException,FeedException {
        SyndFeed feed = new SyndFeedImpl ();

        feed.setTitle ("Exemple de flux (crée avec ROME)");
        feed.setLink ("http://www.mkhelif.fr/");
        feed.setDescription ("Ce flux a été crée grâce à la librairie ROME");

        List entries = new ArrayList ();
        SyndEntry entry;
        SyndContent description;

        entry = new SyndEntryImpl ();
        entry.setTitle ("ROME v0.1");
        entry.setLink ("http://wiki.java.net/bin/view/Javawsxml/rome01");
        try {
            entry.setPublishedDate (DATE_PARSER.parse ("2004-06-08"));
        } catch (ParseException ex) {
            // Impossible dans cet exemple
        }
        description = new SyndContentImpl ();
        description.setType ("text/plain");
        description.setValue ("Initial release of ROME");
        entry.setDescription (description);
        entries.add (entry);

        entry = new SyndEntryImpl ();
        entry.setTitle ("Rome v0.2");
        entry.setLink ("http://wiki.java.net/bin/view/Javawsxml/rome02");
        try {
            entry.setPublishedDate (DATE_PARSER.parse("2004-06-16"));
        } catch (ParseException ex) {
            // Impossible dans cet exemple
        }
        description = new SyndContentImpl ();
        description.setType ("text/plain");
        description.setValue ("Bug fixes, minor API changes and some new features"+
                              "For details check the <a href="http://wiki.java.net/bin/view/Javawsxml/RomeChangesLog#Rome">Changes Log for 0.2</a>");
        entry.setDescription (description);
        entries.add (entry);

        entry = new SyndEntryImpl ();
        entry.setTitle ("ROME v0.3");
        entry.setLink ("http://wiki.java.net/bin/view/Javawsxml/rome03");
        try {
            entry.setPublishedDate (DATE_PARSER.parse("2004-07-27"));
        } catch (ParseException ex) {
            // Impossible dans cet exemple
        }
        description = new SyndContentImpl ();
        description.setType ("text/html");
        description.setValue ("Bug fixes, API changes, some new features and some Unit testing" +
                                     "For details check the <a href="http://wiki.java.net/bin/view/Javawsxml/RomeChangesLog#Rome">Changes Log for 0.3</a>");
        entry.setDescription (description);
        entries.add (entry);

        entry = new SyndEntryImpl ();
        entry.setTitle ("ROME v0.4");
        entry.setLink ("http://wiki.java.net/bin/view/Javawsxml/rome04");
        try {
            entry.setPublishedDate (DATE_PARSER.parse("2004-09-24"));
        } catch (ParseException ex) {
            // Impossible dans cet exemple
        }
        description = new SyndContentImpl ();
        description.setType ("text/html");
        description.setValue ("Bug fixes, API changes, some new features, Unit testing completed" +
                              "For details check the <a href="http://wiki.java.net/bin/view/Javawsxml/RomeChangesLog#Rome">Changes Log for 0.4</a>");
        entry.setDescription (description);
        entries.add (entry);

        feed.setEntries (entries);

        return feed;
    } // getFeed ()
} // FeedServlet</pre>

<p>Pour utiliser cette Servlet nous devons créer une application Web pour laquelle il nous faut un fichier web.xml :</p>

<pre lang="xml"><code>
&lt; ?xml version="1.0" encoding="UTF-8"?&gt;

&lt; !DOCTYPE web-app PUBLIC "-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN" "http://java.sun.com/dtd/web-app_2_3.dtd"&gt;
&lt;web&gt;
    &lt;display&gt;Exemple ROME&lt;/display&gt;

    &lt;servlet&gt;
        &lt;/servlet&gt;&lt;servlet -name&gt;FeedServlet&lt;/servlet&gt;
        &lt;servlet -class&gt;com.mkhelif.rome.exemples.FeedServlet&lt;/servlet&gt;
        &lt;init -param&gt;


        &lt;/init&gt;

    &lt;servlet -mapping&gt;
         &lt;/servlet&gt;&lt;servlet -name&gt;FeedServlet&lt;/servlet&gt;
         &lt;url -pattern&gt;/feed&lt;/url&gt;

&lt;/web&gt;
</code>
</pre>

<p>Pour créer l’application lancer la commande suivante dans le sous-projet d’exemples : maven war.</p>

<p>Le fichier WAR, exemples-rome.war, va être crée dans le répertoire cible. Déployer le WAR dans un conteneur de Servlet et la FeedServlet devrait être prête.</p>

<p>Si vous utilisé Tomcat 4 ou Tomcat 5 et que le fichier WAR a été mis dans le répertoire <em>${TOMCAT}/webapps</em>, l’URL pour accéder à la Servlet devrais être <em>http://localhost:8080/exemples-rome/feed</em>.</p>

    </section>
</article>
<footer id="post-meta" class="clearfix">
    <a href="http://twitter.com/mkhelif">
        <img class="avatar" src="/assets/images/avatar.png">
        <div>
            <span class="dark">Marwan Khelif</span>
            <span>Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description.
</span>
        </div>
    </a>

    <section id="sharing">
        <a class="twitter" href="https://twitter.com/intent/tweet?text=/blog/rome-integration-avec-une-servlet-78/ - ROME &#8211; Intégration avec une Servlet (7/8) by @mkhelif"><span class="icon-twitter"> Tweet</span></a>

<a class="facebook" href="#" onclick="
    window.open(
      'https://www.facebook.com/sharer/sharer.php?u='+encodeURIComponent(location.href),
      'facebook-share-dialog',
      'width=626,height=436');
    return false;"><span class="icon-facebook-rect"> Share</span>
</a>
    </section>
</footer>

<!-- Disqus comments -->


<!-- Archive post list -->

    <ul id="post-list" class="archive readmore">
        <h3>Read more</h3>
        
            <li>
                <a href="/2015/welcome-to-jekyll/">Welcome to Jekyll!<aside class="dates">Jun 19</aside></a>
            </li>
        
            <li>
                <a href="/nosql-premiers-pas-avec-cassandra/">NoSQL : premiers pas avec Cassandra<aside class="dates">Oct 01</aside></a>
            </li>
        
            <li>
                <a href="/gwt-2-0-les-nouvelles-fonctionnalits/">GWT 2.0 : les nouvelles fonctionnalités<aside class="dates">Jan 14</aside></a>
            </li>
        
            <li>
                <a href="/goo-gl-le-raccourcisseur-durl-by-google/">Goo.gl : le raccourcisseur d’URL by Google<aside class="dates">Dec 15</aside></a>
            </li>
        
            <li>
                <a href="/chrome-os-premire-prsentation/">Chrome OS : première présentation<aside class="dates">Nov 19</aside></a>
            </li>
        
            <li>
                <a href="/twitter-interets-des-listes/">Twitter : intérêts des listes<aside class="dates">Oct 31</aside></a>
            </li>
        
            <li>
                <a href="/guide-doptimisation-de-vos-applications-web/">Guide d’optimisation de vos applications Web<aside class="dates">Oct 20</aside></a>
            </li>
        
            <li>
                <a href="/twitter-la-voip-disponible-grce-jajah/">Twitter : la VoIP disponible grâce à Jajah<aside class="dates">Sep 18</aside></a>
            </li>
        
            <li>
                <a href="/cinq-moyens-pour-grer-son-identit-virtuelle/">Cinq moyens pour gérer son identité virtuelle<aside class="dates">Sep 12</aside></a>
            </li>
        
            <li>
                <a href="/ruby-on-rails-dployer-une-application-sur-tomcat-avec-jruby/">Ruby on Rails : déployer une application sur Tomcat avec JRuby<aside class="dates">Sep 07</aside></a>
            </li>
        
            <li>
                <a href="/quest-ce-quun-community-manager-le-buzz-job-actuel/">Qu’est ce qu’un Community Manager, le “buzz-job” actuel ?<aside class="dates">Aug 28</aside></a>
            </li>
        
            <li>
                <a href="/tests-en-charge-dec2-gae-et-azure/">Tests en charge d’EC2, GAE et Azure<aside class="dates">Aug 21</aside></a>
            </li>
        
            <li>
                <a href="/google-vers-une-nouvelle-version-du-moteur-de-recherche/">Google : vers une nouvelle version du moteur de recherche<aside class="dates">Aug 11</aside></a>
            </li>
        
            <li>
                <a href="/chrome-des-thmes-et-de-la-synchronisation/">Chrome : des thèmes et de la synchronisation<aside class="dates">Aug 04</aside></a>
            </li>
        
            <li>
                <a href="/gwt-20-le-grand-nettoyage/">GWT 2.0 : le grand nettoyage<aside class="dates">Aug 03</aside></a>
            </li>
        
            <li>
                <a href="/google-annonce-chrome-os/">Google annonce Chrome OS<aside class="dates">Jul 08</aside></a>
            </li>
        
            <li>
                <a href="/ouverture-du-java-store/">Ouverture du Java Store<aside class="dates">Jun 03</aside></a>
            </li>
        
            <li>
                <a href="/un-fork-de-mysql-pour-contrer-oracle-2/">Un fork de MySQL pour contrer Oracle<aside class="dates">Jun 02</aside></a>
            </li>
        
            <li>
                <a href="/oracle-rachte-sun/">Oracle rachète Sun<aside class="dates">Apr 20</aside></a>
            </li>
        
            <li>
                <a href="/premire-utilisation-du-plugin-eclipse-gwt/">Première utilisation du plugin Eclipse GWT<aside class="dates">Apr 10</aside></a>
            </li>
        
            <li>
                <a href="/flex-builder-3-gratuit-pour-les-chmeurs/">Flex Builder 3 gratuit pour les chômeurs<aside class="dates">Apr 10</aside></a>
            </li>
        
            <li>
                <a href="/google-gwt-version-16-et-consorts/">Google : GWT version 1.6 et consorts<aside class="dates">Apr 08</aside></a>
            </li>
        
            <li>
                <a href="/google-lance-son-propre-fond-dinvestissements/">Google lance son propre fond d&#8217;investissements<aside class="dates">Apr 01</aside></a>
            </li>
        
            <li>
                <a href="/chrome-comment-crer-une-extension/">Chrome : comment créer une extension ?<aside class="dates">Mar 24</aside></a>
            </li>
        
            <li>
                <a href="/skype-le-codec-silk-disponible-gratuitement/">Skype : le codec SILK disponible gratuitement<aside class="dates">Mar 04</aside></a>
            </li>
        
            <li>
                <a href="/html-5-deux-nouveaux-documents/">HTML 5 : deux nouveaux documents<aside class="dates">Feb 18</aside></a>
            </li>
        
            <li>
                <a href="/java-jframe-transparentre/">Java : JFrame transparente<aside class="dates">Jan 23</aside></a>
            </li>
        
            <li>
                <a href="/gwt-16-quoi-de-neuf/">GWT 1.6 : quoi de neuf ?<aside class="dates">Dec 11</aside></a>
            </li>
        
            <li>
                <a href="/gwt-le-futur-hosted-mode/">GWT : le futur hosted mode<aside class="dates">Dec 09</aside></a>
            </li>
        
            <li>
                <a href="/authentification-ssh-par-cl-privecl-publique/">Authentification SSH par clé privée/clé publique<aside class="dates">Nov 24</aside></a>
            </li>
        
            <li>
                <a href="/gwt-librairie-open-flash-chart/">GWT : librairie Open Flash Chart<aside class="dates">Oct 23</aside></a>
            </li>
        
            <li>
                <a href="/gwt-153-amliore-le-support-dandroid/">GWT 1.5.3 : améliore le support d&#8217;Android<aside class="dates">Oct 22</aside></a>
            </li>
        
            <li>
                <a href="/gwt-16-tomcat-ou-jetty/">GWT 1.6 : Tomcat ou Jetty ?<aside class="dates">Oct 21</aside></a>
            </li>
        
            <li>
                <a href="/ria-quel-framework-choisir/">RIA : quel framework choisir?<aside class="dates">Oct 03</aside></a>
            </li>
        
            <li>
                <a href="/gwt-the-great-gwt-roundup/">GWT : &#8220;The Great GWT roundup&#8221;<aside class="dates">Oct 02</aside></a>
            </li>
        
            <li>
                <a href="/gwt-version-15-disponible/">GWT : version 1.5 disponible<aside class="dates">Sep 02</aside></a>
            </li>
        
            <li>
                <a href="/google-lancement-de-chrome/">Google : lancement de Chrome<aside class="dates">Sep 02</aside></a>
            </li>
        
            <li>
                <a href="/google-intgration-de-google-suggest/">Google : intégration de Google Suggest<aside class="dates">Aug 28</aside></a>
            </li>
        
            <li>
                <a href="/java-benchmark-jre/">Java : benchmark de la JRE<aside class="dates">Aug 05</aside></a>
            </li>
        
            <li>
                <a href="/oracle-faille-critique-dans-weblogic/">Oracle : faille critique dans WebLogic [corrigé]<aside class="dates">Jul 30</aside></a>
            </li>
        
            <li>
                <a href="/java-utilisation-de-protocol-buffers/">Java : Utilisation de Protocol Buffers<aside class="dates">Jul 29</aside></a>
            </li>
        
            <li>
                <a href="/google-lance-protocol-buffers/">Google lance Protocol Buffers<aside class="dates">Jul 10</aside></a>
            </li>
        
            <li>
                <a href="/gwt-crer-un-service-rpc/">GWT : Créer un service RPC<aside class="dates">Jul 07</aside></a>
            </li>
        
            <li>
                <a href="/gwt-introduction-au-framework/">GWT : Introduction au framework<aside class="dates">Jul 03</aside></a>
            </li>
        
            <li>
                <a href="/google-rfrencement-des-contenus-flash/">Google : référencement des contenus Flash<aside class="dates">Jul 01</aside></a>
            </li>
        
            <li>
                <a href="/apache2-systeme-de-blacklist/">Apache2 : système de blacklist<aside class="dates">Jun 23</aside></a>
            </li>
        
            <li>
                <a href="/passerelle-entre-apache-et-tomcat/">Passerelle entre Apache et Tomcat<aside class="dates">Jun 18</aside></a>
            </li>
        
            <li>
                <a href="/serveur-de-mails-multi-domaines/">Serveur de mails multi-domaines<aside class="dates">May 23</aside></a>
            </li>
        
            <li>
                <a href="/mysql-workbench/">MySQL Workbench<aside class="dates">May 02</aside></a>
            </li>
        
            <li>
                <a href="/javaone-2008/">JavaOne 2008<aside class="dates">Apr 25</aside></a>
            </li>
        
            <li>
                <a href="/nouveautes-java-7-dolphin/">Nouveautés Java 7 &#8211; Dolphin<aside class="dates">Mar 17</aside></a>
            </li>
        
            <li>
                <a href="/garbage-collector-ancienne-generation/">Garbage Collector ancienne génération<aside class="dates">Mar 15</aside></a>
            </li>
        
            <li>
                <a href="/java-sur-iphone/">Java sur iPhone<aside class="dates">Mar 10</aside></a>
            </li>
        
            <li>
                <a href="/chiffre-de-vigenere/">Chiffre de Vigénère<aside class="dates">Jan 17</aside></a>
            </li>
        
            <li>
                <a href="/chiffre-de-cesar/">Chiffre de César<aside class="dates">Jan 17</aside></a>
            </li>
        
            <li>
                <a href="/chiffre-de-beaufort/">Chiffre de Beaufort<aside class="dates">Jan 16</aside></a>
            </li>
        
            <li>
                <a href="/validation-xml/">Validation XML<aside class="dates">Jan 03</aside></a>
            </li>
        
            <li>
                <a href="/rome-telechargement-88/">ROME &#8211; Téléchargement (8/8)<aside class="dates">Jul 25</aside></a>
            </li>
        
            <li>
                <a href="/rome-integration-avec-une-servlet-78/">ROME &#8211; Intégration avec une Servlet (7/8)<aside class="dates">Jul 22</aside></a>
            </li>
        
            <li>
                <a href="/rome-ecriture-dun-flux-68/">ROME &#8211; Écriture d&#8217;un flux (6/8)<aside class="dates">Jul 21</aside></a>
            </li>
        
            <li>
                <a href="/rome-aggregation-de-plusieurs-flux-58/">ROME &#8211; Aggrégation de plusieurs flux (5/8)<aside class="dates">Jul 20</aside></a>
            </li>
        
            <li>
                <a href="/rome-conversion-dun-format-a-un-autre-48/">ROME &#8211; Conversion d&#8217;un format à un autre (4/8)<aside class="dates">Jul 19</aside></a>
            </li>
        
            <li>
                <a href="/rome-lecture-dun-flux-38/">ROME &#8211; Lecture d&#8217;un flux (3/8)<aside class="dates">Jul 18</aside></a>
            </li>
        
            <li>
                <a href="/rome-fonctionnement-28/">ROME &#8211; Fonctionnement (2/8)<aside class="dates">Jul 16</aside></a>
            </li>
        
            <li>
                <a href="/rome-presentation-18/">ROME &#8211; Présentation (1/8)<aside class="dates">Jul 15</aside></a>
            </li>
        
    </ul>





  </section>

  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
  <script src="/assets/js/main.js"></script>
  <script src="/assets/js/highlight.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>

  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-2859250-3', 'auto');
    ga('send', 'pageview');
  </script>
</body>
</html>



